'use strict';

baseDirectives.directive('myMap', ['appConfig', function(appConfig) {
  return {
    restrict: 'EA',
    templateUrl: 'templates/ol-map.html',
    scope: {
      contorno: '='
    },
    link: function(scope, elm, attrs) {

      var bboxBrasil = [(-9237536), (-4210509.3), (-995344), (288319.6)];


      var bbox = {
        "xmin":-6164645.839643029,
        "ymin":-1495652.2608800775,
        "ymax":-1493759.2278609618,
        "xmax":-6162522.537578204
      };

      var tiles = new ol.layer.Tile({
        source: new ol.source.OSM()
      });

      var src = new ol.source.Vector();

      var styles = [
        new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: '#f79e04',
            width: 2
          }),
          fill: new ol.style.Fill({
            color: 'rgba(228, 164, 20, 0.54)'
          }),image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        })
      ];

      var vector = new ol.layer.Vector({
        source: src,
        style: styles,
        name: 'anyname'
      });

      var satelliteLayer = new ol.layer.Tile({
        source: new ol.source.BingMaps({
          key: appConfig.bingKey,
          imagerySet: 'AerialWithLabels'
        }),
        visible: true
      });

      var formatedBBox = [bbox.xmin, bbox.ymin, bbox.xmax, bbox.ymax];
      var sourceImage = new ol.source.ImageStatic({
        url: "http://local-teste.inceres.com.br/img/testImage.jpg",
        imageExtent: formatedBBox,
        projection: 'EPSG:3857'
      });

      var imageLayer = new ol.layer.Image({
        opacity: 0.9,
        source: sourceImage
      });

      // var wktData = "POLYGON ((-55.37656804650453 -13.30093684553191, -55.37794346756144 -13.2996069841309, -55.37795578935152 -13.29948764549332, -55.37719596339961 -13.29908703170896, -55.37647437657021 -13.29845024474822, -55.37613673226895 -13.29793883490592, -55.37590137111442 -13.29765846688707, -55.37571043571283 -13.29765507705752, -55.37552433867842 -13.29772746584641, -55.3752697993114 -13.2977574459497, -55.3751017165404 -13.29773207932268, -55.37502267121575 -13.29775830985459, -55.37495932658676 -13.29772218628494, -55.37480477905132 -13.2978182771258, -55.37462218715405 -13.29785778455661, -55.37450581894709 -13.29784990853804, -55.3744252000922 -13.2978623994672, -55.37429570676493 -13.29793697159972, -55.3739916830888 -13.29800159548968, -55.37382119129007 -13.29806022331498, -55.37362921086546 -13.29810567969341, -55.37338267271279 -13.29811968297576, -55.37314289443022 -13.29811587442672, -55.37280635647246 -13.29819063360702, -55.37268528769865 -13.29819571402807, -55.3725783189147 -13.2982285389908, -55.37249387752974 -13.29821423886394, -55.3723743356048 -13.29824015380168, -55.3722673520503 -13.29819627681461, -55.37207954895267 -13.29816749519607, -55.3719186095226 -13.29814812740104, -55.37179483720941 -13.29811747330635, -55.37169077105211 -13.29819140919428, -55.37158631001743 -13.2982330694392, -55.37147463494267 -13.29827532217385, -55.37135921960274 -13.29825333460915, -55.37123235792221 -13.29832048743441, -55.37115261610629 -13.29830256347611, -55.37108279458793 -13.29832136297045, -55.37102887043278 -13.29830554469515, -55.37095394603896 -13.29834167690938, -55.37087314923669 -13.29829822756163, -55.3707379937446 -13.29826161683638, -55.3705633146764 -13.29824865788684, -55.37042002703527 -13.29819916427653, -55.37038155599861 -13.29824232588764, -55.37030341644309 -13.29820444042316, -55.37024383442167 -13.29827629675167, -55.37015397010845 -13.29830072976453, -55.37009404550314 -13.29843452827728, -55.37002588538885 -13.2984934517718, -55.36987858573531 -13.29852602163316, -55.36979308997484 -13.29857913334907, -55.36962688737119 -13.29860150338951, -55.36940526431815 -13.29855114857975, -55.36916649175404 -13.29845291798086, -55.36899365639978 -13.29840026278591, -55.36884994250806 -13.29838453091248, -55.36869663557034 -13.29844048054424, -55.3685500065104 -13.29852130964736, -55.36845809441576 -13.2985225451351, -55.36836965569433 -13.29862545476352, -55.36824681284761 -13.29870650483524, -55.36815009970182 -13.29886489585704, -55.36809632088674 -13.29894556798141, -55.36802980537131 -13.29897478404729, -55.36801463091692 -13.29906224564516, -55.36793314670867 -13.29910230912646, -55.36787772804037 -13.29915597349552, -55.36781092727201 -13.29924471547094, -55.36771675010623 -13.29934928208321, -55.36757532641014 -13.29949041448153, -55.36734047322054 -13.29973512015129, -55.36723293403112 -13.29978542178651, -55.36711500566161 -13.29978951807735, -55.36698505787592 -13.29983247628535, -55.36686417609774 -13.29983636984383, -55.36680155625985 -13.29991051944872, -55.36672850116177 -13.29990070584392, -55.36667269882327 -13.29993741665742, -55.36660057638178 -13.29990682196583, -55.36655688650669 -13.29996799733447, -55.36643552023745 -13.29996236644944, -55.36629820203598 -13.29998769804939, -55.36613873217282 -13.29999826891576, -55.36599171391512 -13.29998660929304, -55.36582178422329 -13.29996961808906, -55.36568454275604 -13.29996754348159, -55.36554962282641 -13.29997816421234, -55.36546267500228 -13.30001223565925, -55.36536444828706 -13.30007770491938, -55.36529433412465 -13.30013774244751, -55.36526606126159 -13.30020735930999, -55.36527524852661 -13.30031867320105, -55.36522905591981 -13.30043542618879, -55.36521748200281 -13.30053940079614, -55.36524512789935 -13.30075240284984, -55.36527065346241 -13.30101497990455, -55.36522483380483 -13.30122911340327, -55.36518172333916 -13.30127622697818, -55.36516518543612 -13.30137628043168, -55.36510897419333 -13.30143901292993, -55.36504892428329 -13.30153865178946, -55.36496473580845 -13.30184211868999, -55.36488030066629 -13.30193764316709, -55.36478751275799 -13.30203327639501, -55.36470705414959 -13.30214074623228, -55.36460657918446 -13.30231848220876, -55.36455661019929 -13.30236594330463, -55.36450005212836 -13.30248023046586, -55.36444525197312 -13.30255538382734, -55.36438761458592 -13.30260227568096, -55.3643082526667 -13.30267754372264, -55.36424812282172 -13.30274454228121, -55.36418787391919 -13.30280652566185, -55.36411365633814 -13.30281459349626, -55.36408032733794 -13.30289543538832, -55.36401611218744 -13.30292013947448, -55.36394478448157 -13.30301625020013, -55.36389271907565 -13.30305365609397, -55.36385191174482 -13.3031276182122, -55.36377584060049 -13.30312141592745, -55.36371036423989 -13.3032384472202, -55.36362419641568 -13.30336940963609, -55.36354810365368 -13.30347465224535, -55.36348677135133 -13.30356304016085, -55.36340075695257 -13.3037603363538, -55.36331570260108 -13.30393831914513, -55.36319085591435 -13.3041227922598, -55.36316586754877 -13.30428997542321, -55.36312708269936 -13.30439020180801, -55.36306345660581 -13.30447598471551, -55.36299622178103 -13.30460865042836, -55.36296712032799 -13.30479128311385, -55.36290297842959 -13.30489804765621, -55.36285528972025 -13.3051455270907, -55.3628187543514 -13.30540763655265, -55.36277987463006 -13.3055524107195, -55.36278706111145 -13.30563019461884, -55.36272237066813 -13.30569967789982, -55.362649747938 -13.3059272965088, -55.36258116696393 -13.3060813551622, -55.36252858641473 -13.30619223728171, -55.3624449509698 -13.30636038359324, -55.36232262649833 -13.30645366316708, -55.36219579795706 -13.30658271709444, -55.36212541695918 -13.30674112740713, -55.36205118072764 -13.30682147603941, -55.3617623932342 -13.30712612655132, -55.36164237604092 -13.30716799954006, -55.36148049316652 -13.30740260781099, -55.36133124497067 -13.30759382801519, -55.36104895700348 -13.30790450802337, -55.36096322608098 -13.30804796485442, -55.36072289851849 -13.30830550492055, -55.36041305971356 -13.3085919765207, -55.35987651718911 -13.30892758993251, -55.35938742704651 -13.30921380868474, -55.35888184237517 -13.30940225950292, -55.35901918500262 -13.30958204416931, -55.35944803725088 -13.31010873717038, -55.36006643833768 -13.31080880050205, -55.36123314201369 -13.31219938227479, -55.36280245368747 -13.3139849552907, -55.36304584342818 -13.31420397285856, -55.36327834640367 -13.31403062211068, -55.37172521194311 -13.30573009627608, -55.37656804650453 -13.30093684553191))";

      // var wkt = new ol.format.WKT();
      // var polygon = wkt.readGeometry(wktData);
      // var feature = new ol.Feature();
      // feature.setGeometry(polygon.transform('EPSG:4326', 'EPSG:3857'));
      // vector.getSource().addFeature(feature);

      var centraliza = new ol.control.Control({
        className: 'centra-selecionado',
        element: elm.find('.ol-center-map')[0]
      });

      var controls = ol.control.defaults({
        attributionOptions: {
          collapsible: true
        }
      }).extend([
        centraliza
      ]);

      var map = new ol.Map({
        layers: [
          tiles,
          satelliteLayer,
          vector
        ],
        target: elm.find('.map-container')[0],
        view: new ol.View({
          center: bboxBrasil,
          zoom: 3,
          maxZoom: 19,
          minZoom: 4
        }),
        controls: controls
      });

      // map.getLayers().insertAt(3, imageLayer);

      // map.getView().fit(formatedBBox);

    }
  };
}]);